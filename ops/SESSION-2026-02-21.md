# Session Log — 2026-02-21

## Summary

Short session focused on Openclaw gateway connectivity fix and preparing the runway for JS-01 (lead enrichment workflow).

## What Was Done

### Openclaw Gateway Fix
- Diagnosed "gateway token missing" error — browser Control UI wasn't sending the token
- Retrieved correct gateway token from VM config (`4412ccef...`)
- Identified Caddy basic_auth as additional auth layer for WebSocket connections
- Approved device pairing via `openclaw devices approve` inside the container
- Synced local `config.json` gateway token to match VM

### Openclaw Hooks (n8n ↔ Openclaw Integration)
- Confirmed n8n can reach Openclaw internally at `http://openclaw:18789/`
- Added `hooks` block to VM `config.json` (enabled, `/hooks` path, dedicated hook token, allowedAgentIds: main)
- Generated dedicated hook token (separate from gateway token) — stored in VM `.env` as `OPENCLAW_HOOK_TOKEN`
- Restarted Openclaw, n8n, and n8n-worker to pick up changes
- Verified end-to-end: `POST /hooks/wake` returns `{"ok":true}` and TAR received the event

### JS-01 Workflow Runway Prep
- Created `public.leads` table from `sql/001_create_leads.sql`
- Changed unique index from `(domain, email)` to `(domain)` only — matches v1 operating model where email may not exist yet
- Updated local SQL schema to match
- Verified all 4 n8n credentials are connected: Gmail (OAuth2), Google Drive (OAuth2), Postgres, HubSpot (App Token)

## Key Decisions
- Hooks are **internal only** (Docker network) — not exposed via Caddy
- Hook token stored as n8n env var / credential — never hardcoded in workflow JSON
- v1 lead dedupe on **domain only** (email added later with enrichment)
- Openclaw (TAR) will build the JS-01 workflow JSON per WORKFLOW_CONTRACT.md

## What's Next
- TAR generates JS-01 `/lead` workflow JSON for review
- Workflow uses: HubSpot, Postgres, Drive, Gmail, Openclaw hooks (`/hooks/agent`)
- Error notifications via email only

## Stack State at Close
- All 9 services healthy
- Openclaw gateway connected, hooks enabled
- `leads` table live with `domain`-only unique index
- n8n has all 4 required credentials + `OPENCLAW_HOOK_TOKEN` env var
